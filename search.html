<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />/
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Search Books</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-brand">Library Management</div>
    <div class="nav-links">
      <a href="index.html"><i class="fas fa-home"></i> Home</a>
      <a href="books.html"><i class="fas fa-book"></i> Books</a>
      <a href="add-book.html"><i class="fas fa-plus"></i> Add Book</a>
      <a href="update-book.html"><i class="fas fa-edit"></i> Update Book</a>
      <a href="search.html" class="active"><i class="fas fa-search"></i> Search</a>
    </div>
  </nav>

  <div class="container">
    <div class="page-header">
      <h1><i class="fas fa-search"></i> Search Books</h1>
    </div>

    <div class="search-container">
      <div class="search-box" style="margin-bottom: 2rem;">
        <form id="searchForm" style="display: flex; gap: 1rem; align-items: center;">
          <input type="text" id="searchInput" class="form-control" 
                 placeholder="Search by title, author, or ISBN..." 
                 autocomplete="off" style="max-width: 350px;">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-search"></i> Search
          </button>
        </form>
      </div>

      <div id="searchResults" class="search-results">
        <div class="initial-state">
          <i class="fas fa-search"></i>
          <p>Enter your search terms above to find books</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Add event listener for Enter key
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        searchBooks();
      }
    });

    document.getElementById('searchForm').addEventListener('submit', function(e) {
      e.preventDefault();
      searchBooks();
    });

    function searchBooks() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      
      if (searchTerm.length < 2) {
        document.getElementById('searchResults').innerHTML = `
          <div class="initial-state">
            <i class="fas fa-search"></i>
            <p>Please enter at least 2 characters to search</p>
          </div>
        `;
        return;
      }

      // Show loading state
      document.getElementById('searchResults').innerHTML = `
        <div class="loading-state">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Searching...</p>
        </div>
      `;

      // Make the API call
      fetch(`/books/search?q=${encodeURIComponent(searchTerm)}`)
        .then(res => res.json())
        .then(data => {
          const resultsDiv = document.getElementById('searchResults');
          
          if (data.length === 0) {
            resultsDiv.innerHTML = `
              <div class="no-results">
                <i class="fas fa-book-open"></i>
                <p>No books found matching your search</p>
                <p class="search-tip">Try different keywords or check your spelling</p>
              </div>
            `;
            return;
          }

          // Display results in a table format
          resultsDiv.innerHTML = `
            <div class="results-header">
              <h3>Found ${data.length} results</h3>
            </div>
            <div class="results-table">
              <table>
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>ISBN</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  ${data.map(book => `
                    <tr>
                      <td>${book.title}</td>
                      <td>${book.author}</td>
                      <td>${book.isbn}</td>
                      <td>
                        <a href="update-book.html?id=${book.id}" class="btn btn-sm btn-warning">
                          <i class="fas fa-edit"></i> Edit
                        </a>
                        <button onclick="deleteBook(${book.id})" class="btn btn-sm btn-danger">
                          <i class="fas fa-trash"></i> Delete
                        </button>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `;
        })
        .catch(error => {
          document.getElementById('searchResults').innerHTML = `
            <div class="error-state">
              <i class="fas fa-exclamation-circle"></i>
              <p>Error searching books. Please try again.</p>
            </div>
          `;
        });
    }

    function deleteBook(id) {
      if (confirm('Are you sure you want to delete this book?')) {
        fetch(`/books/${id}`, {
          method: 'DELETE'
        })
        .then(() => {
          // Remove the book row with animation
          const row = document.querySelector(`tr[data-id="${id}"]`);
          if (row) {
            row.style.opacity = '0';
            setTimeout(() => {
              row.remove();
              // Check if no results left
              if (document.querySelectorAll('tbody tr').length === 0) {
                document.getElementById('searchResults').innerHTML = `
                  <div class="no-results">
                    <i class="fas fa-book-open"></i>
                    <p>No books found matching your search</p>
                    <p class="search-tip">Try different keywords or check your spelling</p>
                  </div>
                `;
              }
            }, 300);
          }
        })
        .catch(error => {
          alert('Error deleting book. Please try again.');
        });
      }
    }
  </script>
</body>
</html>